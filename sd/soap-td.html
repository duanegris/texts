<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>TD SOAP</title>

<style type="text/css">

.innerbox {margin: 25pt;
	     padding:10pt;
	     background-color:#fffffd;
	     border : solid black 1px;
	}

</style>
</head>
<body>

<div class="innerbox">

<i>Note</i>: les exercices demandent d'écrire les programmes princpalement en PHP. Vous pourrez vous aider
des explications suivantes sur les tableaux en PHP si vous en avez besoin:
<a href="http://icps.u-strasbg.fr/~genaud/courses/webtech/php/ch03.html#id2608323">http://icps.u-strasbg.fr/~genaud/courses/webtech/php/ch03.html#id2608323</a>.


<h1>Utilisation d'un service commercial de géolocalisation</h1>

<p>
La société <a href="http://www.fraudlabs.com">FraudLabs</a> propose un ensemble (payants) de services web
ayant trait &agrave; la géo-localisation. Ceux-ci peuvent par exemple être utilisés pour 
vérifier la validité d'une adresse saisie par un client, pour localiser géographiquement
un client d'après l'IP de sa machine, ...
</p>
<p>

</p>



On souhaite utiliser le service de Géolocalisation qui à une adresse IP rend les coordonnées géographiques (lattitude, longitude) de la machine.
Examiner la description WSDL du service :
<a href="http://ws.ip2location.com/ip2locationwebservice.asmx?wsdl">
http://ws.ip2location.com/ip2locationwebservice.asmx?wsdl
</a>
	
<ol>
	<li><i>Analyse du WSDL</i>
	<ul>
		<li>Cherchez le nom de la méthode unique proposée par ce service.
		<!-- <wsdl:operation name="IP2Location"> -->
		</li>
		<li>Cherchez les entrées et sorties de cette méthode.
		Quel est le nom des entrées, quel est le nom des sorties ?
		<!-- <wsdl:types> 
			in = <s:element name="IP2Location">
			out = <s:element name=IP2LocationResponse">
		-->
		</li>
		<li>
		<li>
		Quels sont les paramètres (nom et types) qui composent l'entrée ?
		</li>
		<li>
		Quels sont les paramètres (nom et types) qui composent l'entrée ?
		</li>
		<!-- entree :  
                 <s:complexType>
	             <s:sequence>
                      <s:element minOccurs="0" maxOccurs="1" name="IP" type="s:string"/>
                      <s:element minOccurs="0" maxOccurs="1" name="LICENSE" type="s:string"/>
	             </s:sequence>
                 </s:complexType>

			sortie:
	               <s:complexType>
	                 <s:sequence>
                          <s:element minOccurs="0" maxOccurs="1" name="IP2LocationResult" type="tns:IP2LOCATION"/>
                       </s:sequence>
                     </s:complexType>
		-->
        	</li>
		<li>
		A quels noms de champs le type de la sortie fait il référence ?
		<!--
	        <s:sequence>
                  <s:element minOccurs="0" maxOccurs="1" name="COUNTRYCODE" type="s:string"/>
                  <s:element minOccurs="0" maxOccurs="1" name="COUNTRYNAME" type="s:string"/>
                  <s:element minOccurs="0" maxOccurs="1" name="REGION" type="s:string"/>
                  <s:element minOccurs="0" maxOccurs="1" name="CITY" type="s:string"/>
                  <s:element minOccurs="1" maxOccurs="1" name="LATITUDE" type="s:float"/>
                  <s:element minOccurs="1" maxOccurs="1" name="LONGITUDE" type="s:float"/>
                  <s:element minOccurs="0" maxOccurs="1" name="ZIPCODE" type="s:string"/>
                  <s:element minOccurs="0" maxOccurs="1" name="ISPNAME" type="s:string"/>
                  <s:element minOccurs="0" maxOccurs="1" name="DOMAINNAME" type="s:string"/>
                  <s:element minOccurs="0" maxOccurs="1" name="CREDITSAVAILABLE" type="s:string"/>
          	</s:sequence>
		-->
		</li>
	</ul>
	<li><i>Ecriture d'un client PHP :</i>
	<ul>
		<li>Demander un numéro de license gratuit : <a href="http://www.fraudlabs.com/freelicense.aspx?PackageID=1">http://www.fraudlabs.com/freelicense.aspx?PackageID=1</a>.</li>
		<li>Vous disposez d'un interpréteur PHP5 (taper <tt>php</tt> ou <tt>php5</tt>) compilé avec le support SOAP (taper  <tt>php -i</tt> pour le vérifier).</li>
		<li>Appeler le web-service: construisez un tableau associatif pour les paramètres d'entrée ("IP" et "LICENSE").</li>
		<!-- array("IP" => "130.79.192.160", "LICENSE" => "OA-457-....") -->

		<li>Afficher la réponse: si le champ <tt>Err</tt> n'est pas vide, afficher les valeurs de latitude, longitude, sinon afficher l'erreur.
		<!-- 
	   	$result = $SoapResponse -> GetLocationByIPResult;
	   	if (!isset($result->Error)) {
     			 print("IP $query localisee aux coordonnees geographiques (lat,lon) : ".$result->LATITUDE ."Â°,". $result->LONGITUDE."Â°\n");
   	   	}
   	   	else
      		print("Erreur : " . $result->Error->Desc . "\n");

		_________________
		programme complet: http://tag.u-strasbg.fr/~genaud/tutorial/sd/cvs/src/soap/php/ip2location_wsdl.php
			
		-->
	</ul>
</ol>


<h1>Utilisation d'un dictionnaire</h1>

<p>
Recherche dans des dictionnaires. 
Le noeud SOAP <a href="http://services.aonaware.com/DictService/DictService.asmx">
http://services.aonaware.com/DictService/DictService.asmx
</a> fournit différents services.
On souhaite utiliser la méthode Define qui rend la définition d'un mot anglais.
</p>
<ol>
	<li>Le paramètre d'entrée de Define est une chaine unique (word).
	Schématiser la structure (imbrication des champs) de la réponse.</li>
	<!--
		DefineResult
			Word
			Definitions
				Definition
				Word
				Dictionnary
					Id
					Name
	-->
	<li>Ecrire un client PHP qui utilise cette méthode. 
Vous pouvez utiliser le WSDL disponible : <a href="http://services.aonaware.com/DictService/DictService.asmx?WSDL">
http://services.aonaware.com/DictService/DictService.asmx?WSDL
</a>.
(Conseil : vous devrez utiliser 3 niveaux d'itérations pour parcourir le résultat contenu dans <tt>DefineResult</tt> ; la primitive <tt>foreach ($tableau as $cle =&gt; $val) {}</tt> est adéquate pour cela. La primitive <tt>var_dump($variable)</tt> ou <tt>print_r($variable)</tt> est également d'un grand secours pour analyser la structuration des données générée par la classe SoapClient).</li>
	<!--

		Reponse (principe d'acces aux donnees) : 
		________________________________________
            Une fois l'objet de la classe Soapclient construit avec l'url du wsdl,
            ...
		$SoapResponse = $SoapClient->Define(array("word" => "Moon"));
            ...
            on peut par exemple acceder au mot de recherche rendu par le service (Word) par :
            ...
	      $Result = $SoapResponse->DefineResult;
	      echo "-> Resultat pour $Result->Word :\n";
            ...
            on peut acceder au nom du dictionnaire utilise pour la premiere definition retournee par :
		$DicoDef1 = $Result->Definitions->Definition[0]->Dictionary->Name;
		_____________________	

		programme complet : http://tag.u-strasbg.fr/~genaud/tutorial/sd/cvs/src/soap/php/DictService_wsdl.php.txt
	-->
	<li>Question subsidiaire: Ecrire un client SOAP::Lite qui utilise cette méthode.</li>
</ol>



</div> <!-- innerbox -->
</body>
</html>

