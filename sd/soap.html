<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" /> 
<title>Web-services</title>
<!-- metadata -->
<meta name="generator" content="S5" />
<meta name="version" content="S5 1.1" />
<meta name="presdate" content="20061117" />
<meta name="author" content="S. Genaud" />
<meta name="company" content="UniversitÃ© Louis Pasteur" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<link rel="stylesheet" href="ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/default/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/default/opera.css" type="text/css" media="projection" id="operaFix" />
<!-- embedded styles -->
<style type="text/css" media="all">
.imgcon {width: 525px; margin: 0 auto; padding: 0; text-align: center;}
#anim {width: 270px; height: 320px; position: relative; margin-top: 0.5em;}
#anim img {position: absolute; top: 42px; left: 24px;}
img#me01 {top: 0; left: 0;}
img#me02 {left: 23px;}
img#me04 {top: 44px;}
img#me05 {top: 43px;left: 36px;}

.important { color : red; }

table.list { border-spacing : 3px; 
             margin-left: auto; 
             margin-right : auto; /* pour centrer la table */ 
           }
tr.list    { background-color : #eee59a; font : fixed; }
th.list    { background-color : #c2ddeb; }
td.list    { background-color : #eee59a; margin : 3px; 
        font-family : courier ; font-size : 12pt;}


.listing pre { 
	     padding: 0; margin: 0; 
           background-color : #c2ddeb; 
           font-size : small; 
           border-bottom: 1px solid #000;
           border-top   : 1px solid #000;
           width: 100%; position: relative;
}
.listing-normal pre { 
	     padding: 0; margin: 0; 
           background-color : #c2ddeb; 
           border-bottom: 1px solid #000;
           border-top   : 1px solid #000;
           width: 100%; position: relative;
}
</style>


<!-- S5 JS -->
<script src="ui/default/slides.js" type="text/javascript"></script>
</head>


<body>

<div class="layout">
<div id="controls"><!-- DO NOT EDIT --></div>
<div id="currentSlide"><!-- DO NOT EDIT --></div>
<div id="header"></div>
<div id="footer">
<h1>Novembre &#8226; 2006</h1>
<h2>Les Web services</h2>
</div>
</div>

<div class="presentation">

<div class="slide">
<h1>Les Web services</h1>
<h4><a href="http://icps.u-strasbg.fr/~genaud">StÃ©phane Genaud</a></h4>
</div>


<div class="slide">
<h1>Introduction</h1>

<p>
Les web-services sont aujourd'hui implÃ©mentÃ©s dans leur Ã©crasante majoritÃ© en SOAP et WSDL.
</p>
<p>
Pas de nouveautÃ© conceptuelle par rapport Ã  d'autres propositions antÃ©rieures (e.g. DCE RPC ou CORBA IIOP), mais un engouement inÃ©galÃ© de la part de l'industrie (e.g. Microsoft, IBM, Sun Microsystems, BEA, HP, Oracle, SAP, ...).
</p>
<p>
Une part du succÃ¨s de SOAP vient de son adossement au <a href="http://www.w3.org">W3C</a>, qui
publie la spÃ©cification de SOAP sous la forme d'une 
 <a href="http://www.w3.org/TR/soap/">recommandation</a>.
</p>
</div>

<!-- ______________________ SOAP __________________________ -->

<div class="slide">
<h1>Qu'est ce que SOAP ?</h1>

DÃ©finition du W3C: 
 <ul>
	   <li> SOAP est un protocole lÃ©ger pour l'Ã©change d'information en environnement distribuÃ©.</li> 
	   
	   <li>SOAP utilise les technologies XML pour bÃ©nÃ©ficier d'un cadre extensible dans lequel des messages peuvent Ãªtre Ã©changÃ©s avec des protocoles sous-jacents divers.</li>
	   <li>Sa conception se veut indÃ©pendante de tout modÃ¨le de programmation ou implÃ©mentation spÃ©cifiques.</li>
 </ul>
</div>

<!-- ______________________ SOAP __________________________ -->
<div class="slide">
<h1>SOAP</h1>
Dans les grandes lignes: 
 <ul>
	   <li>SOAP:  Simple Object Access Protocol (juste un acronyme aujourd'hui).</li>
	   
	   <li>Un protocole d'Ã©change dÃ©fini au dessus du protocole de transport (HTTP, SMTP ou mÃªme TCP/IP).</li>
	   <li>XML est utilisÃ© pour l'encodage des donnÃ©es (la plupart des messages sont du texte).</li>
	   <li>Propose des appels de mÃ©thodes distantes (RPC).</li>
 </ul>
 <p>
 De par sa simplicitÃ© et les standards utilisÃ©s, SOAP doit permettre d'embarquer
 des services distants dans n'importe quelle application.
 </p>
 
</div>

<!-- ______________________ SOAP motivation__________________________ -->

<div class="slide">
<h1>SOAP intÃ©rÃªts</h1>
 <p>
 De par sa simplicitÃ© et les standards utilisÃ©s, SOAP doit permettre d'embarquer
 des services distants dans n'importe quelle application.
 </p>
 
 <img style="margin:auto" src="soap-img/www.soapuser.com-archi1.gif" alt="architecture example"/>
</div>


<!-- ______________________ Exemple de message __________________________ -->
<div class="slide">
<h1>Exemple de message</h1>

<div class="listing" style="font-size:larger">
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;soap:Envelope
        xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" &gt;
     &lt;soap:Body&gt;
        &lt;po:purchaseOrder orderDate="2003-09-22" 
               xmlns:po="http://www.Monson-Haefel.com/jwsbook/PO"&gt;
          &lt;po:accountName&gt;Amazon.com&lt;/po:accountName&gt;
          &lt;po:accountNumber&gt;923&lt;/po:accountNumber&gt;
          &lt;po:address&gt;
             &lt;po:name&gt;AMAZON.COM&lt;/po:name&gt;
             &lt;po:street&gt;1850 Mercer Drive&lt;/po:street&gt;
             &lt;po:city&gt;Lexington&lt;/po:city&gt;
             &lt;po:state&gt;KY&lt;/po:state&gt;
             &lt;po:zip&gt;40511&lt;/po:zip&gt;
          &lt;/po:address&gt;
          &lt;po:book&gt;
             &lt;po:title&gt;J2EE Web Services&lt;/po:title&gt;
             &lt;po:quantity&gt;300&lt;/po:quantity&gt;
             &lt;po:wholesale-price&gt;24.99&lt;/po:wholesale-price&gt;
          &lt;/po:book&gt;
        &lt;/po:purchaseOrder&gt;
     &lt;/soap:Body&gt;
  &lt;/soap:Envelope&gt;
</pre>
</div>
Remarques:
<p>
Le protocole prÃ©voit que ce message peut Ãªtre transportÃ© d'un emÃ©tteur vers
un destinataire final Ã  travers des intermÃ©diaires Ã©ventuels.
</p>
<p>
Les langages XML utilisÃ©s dans les messages peuvent Ãªtre multiples.
</p>
</div>

<!-- _________________ Namespaces _________________ -->
<div class="slide">
<h1>Namespaces (encart)</h1>

<p>
<b>Rappel</b>: les namespaces (espaces de nommage) permettent d'Ã©viter les conflits de noms. L'objectif est de permettre l'emploi de plusieurs langages dans un seul document.
</p>
<ul>
<li>On associe un <em>prÃ©fixe</em> avec une URI. L'association se fait avec
l'attribut <span class="important"><tt>xmlns:<i>prefixe</i>="<i>URI</i>"</tt></span> oÃ¹ <tt>xmlns</tt> est un mot clÃ©.</li>
<li><tt><i>prefixe</i></tt> permet ensuite de prÃ©fixer les noms de balise.</li>
<li>L'URI n'est pas accÃ©dÃ©e. Elle sert d'identifiant unique.</li>
</ul>

<p>
<div class="listing-normal">
<pre>
&lt;balise xmlns:mynsp="http://icps.u-strasbg.fr/course/sd/2005"&gt;
&lt;mynsp:syllabus&gt;
    ...
&lt;/mysnp:syllabus&gt;
&lt;/balise&gt;
</pre>
</div>
</p>

</div>
<!-- _________________ Namespaces _________________ -->
<div class="slide">
<h1>Namespaces (encart - suite)</h1>
<p>
On peut utiliser des <em>default namespaces</em> pour ne pas avoir Ã  spÃ©cifier le prÃ©fixe Ã  chaque balise. Ils ont dÃ©finis avec <tt>xmlns</tt> <span class="important">sans</span> prÃ©fixe.
</p>

<div class="listing-normal">
<pre>
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
   &lt;title&gt;...&lt;/title&gt;
&lt;/html&gt;
</pre>
</div>


</div>
<!-- _________________ SOAP message structure _________________ -->
<div class="slide">
<h1>Message SOAP - structure</h1>


<img style="float:left;margin:20pt" src="soap-img/soap_envelope_structure.gif" alt="message structure"/>
 
Un message SOAP est dans une <tt>Envelope</tt>, qui contient :
<ul>
<li>Les namespaces utilisÃ©s,</li>
<li>Un <tt>Header</tt> optionnel, qui peut Ãªtre traitÃ© par des intÃ©rmÃ©diaires,</li>
<li>Un <tt>Body</tt> obligatoire, traitÃ© par le rÃ©cepteur final.</li>
</ul>
</div>

<!-- _________________ SOAP message Header _________________ -->
<div class="slide">
<h1>Message SOAP - Header et Body</h1>

<p>
L'entÃªte <tt>Header</tt> est optionnelle:
</p>
<ul>
<li>PrÃ©vue pour Ãªtre extensible: diffÃ©rents <tt>header blocks</tt> 
    peuvent Ãªtre lus, ajoutÃ©s ou supprimÃ©s au passage d'intÃ©rmÃ©diares.</li>
</ul>

<p>
Le corps <tt>Body</tt> est obligatoire:
</p>
<ul>
<li>Le body est fait de blocs.</li> 
<li>Lus uniquement par le destinataire final.</li>
<li>La nature de l'information transportÃ©e peut Ãªtre:
    <ul>
     <li>Des donnÃ©es (XML document) (document style)</li>
     <li>RPC method and parameters (rpc style)</li>
     <li>Une information d'erreur (SOAP fault)</li>
     </ul>
</li>
</ul>

</div>


<!-- ============================ SOAP RPC  ================== -->

<div class="slide">
<h1>Messages RPC</h1>

<p>
SOAP 1.2 :<br/>
La dÃ©finition du format des messages de style RPC se trouve dans 
<a href="http://www.w3.org/TR/2003/REC-soap12-part2-20030624/#soapforrpc">
la partie 2, section 4</a> 
de la <a href="http://www.w3.org/TR/soap/">recommandation</a>.
</p>

<p>
Les Ã©lÃ©ments nÃ©cessaires Ã  un appel RPC sont :
</p>
<ol>
   <li>l'adresse du noeud SOAP final (destinataire), </li>
   <li>le nom du service (ou classe, ou mÃ©thode) Ã  invoquer,</li>
   <li>l'identification et le type des paramÃ¨tres d'entrÃ©e et de retour.</li>
</ol>
<p>
Note: par analogie avec les modÃ¨les RPC existants, 1. est souvent dÃ©nommÃ© <em>proxy</em>.
</p>
</div>


<div class="slide">
<h1>SOAP RPC requÃªte/rÃ©ponse</h1>


Soit la mÃ©thode <i>foisdeux()</i> de signature: <tt> int foisdeux(int)</tt>.<br/>
La requÃªte <tt>foisdeux(63)</tt> est encodÃ© dans un message comme:

<div class="listing-normal">
<pre>
   &lt;body&gt;
     &lt;ns1:<span style="color:firebrick">foisdeux</span> xmlns:ns1="urn:montest"&gt;
        &lt;param1 xsi:type="xsd:int"&gt;63&lt;/param1&gt;
     &lt;/ns1:foisdeux&gt;
   &lt;/body&gt;
</pre>
</div>

<p>
Le message en rÃ©ponse devrait Ãªtre:
</p>

<div class="listing-normal">
<pre>
   &lt;body&gt;
     &lt;ns1:<span style="color:red">foisdeuxResponse</span> xmlns:ns1="urn:montest"&gt;
	  &lt;<span style="color:red">return</span> xsi:type="xsd:int"&gt;126&lt;/return&gt;
     &lt;/ns1:foisdeux&gt;
   &lt;/body&gt;
</pre>
</div>
<p>
Toujours un seul paramÃ¨tre en retour, de type simple ou complexe.
Utilise l'espace de nommage de  <a href="http://www.w3.org/XML/Schema">XML Schema</a> pour les types.
</p>

</div>



<div class="slide">
<h1>SpÃ©cification du service</h1>

<p>
Dans l'exemple prÃ©cÃ©dent, l'utilisateur du service doit connaÃ®tre, 
le nom des opÃ©rations disponibles, le type des entrÃ©es et sorties, Ã  quel hÃ´te s'adresser, ....
</p>
Un format de description Ã  Ã©tÃ© proposÃ©, permettant de dÃ©crire des web-services: WSDL.
<p>

</div>
<!-- _________________ WSDL _________________ -->
<a name="wsdl"></a>
<div class="slide">
<h1>WSDL</h1>

<p>
WSDL (Web Service Description Language) permet la dÃ©finition de <em>web services</em> dans un langage XML.
C'est une <a href="http://www.w3.org/TR/wsdl">note du W3C</a>.
</p>

<p>
Un document WSDL utilise les Ã©lÃ©ments suivants:
<p/>

<table border="1" class="ex" width="100%">
  <tr>
    <th align="left" width="20%">Element</th>
    <th align="left" width="80%">DÃ©finit</th>
  </tr>
  <tr>
    <td valign="top">&lt;portType&gt;</td>
    <td valign="top">Les opÃ©rations proposÃ©es par le web service</td>

  </tr>
  <tr>
    <td valign="top">&lt;message&gt;</td>
    <td valign="top">Les messages utilisÃ©s par le web service</td>
  </tr>
  <tr>
    <td valign="top">&lt;types&gt;</td>

    <td valign="top">les types de donnÃ©es utilisÃ©es par le web service</td>
  </tr>
  <tr>
    <td valign="top">&lt;binding&gt;</td>
    <td valign="top">Les protocols de communication utilisÃ©s par le web service</td>
  </tr>
</table>


</div>



<div class="slide">
<h1>Structure d'un document WSDL</h1>

<div class="listing-normal">
<pre>
&lt;definitions&gt;
&lt;types&gt;
... (utilise la notation des <a href="http://www.w3.org/XML/Schema">XML Schema</a>) ....
&lt;/types&gt;

&lt;message&gt;
...
&lt;/message&gt;

&lt;portType&gt;
...
&lt;/portType&gt;

&lt;binding&gt;
...
&lt;/binding&gt;
&lt;/definitions&gt;
</pre>
</div>
</div>


<div class="handout">
        <p>Un doc. WSDL peut contenir d'autres Ã©lÃ©ments, e.g.
        les Ã©lÃ©ments extension et services permettant de gouper les dÃ©finitions de plusieurs 
        web services en 1 seul doc.</p>
</div>

<div class="slide">
<h1>Hello World en WSDL</h1>

<p>
Exemple: si vous passez le paramÃ¨tre "monde", le service renvoie la chaine "Bonjour, monde !"
</p>

<div class="listing-normal">
<pre>
&lt;definitions name="HelloService"
    targetNamespace="http://www.ecerami.com/wsdl/HelloService.wsdl"
    xmlns="http://schemas.xmlsoap.org/wsdl/"
    xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
    xmlns:tns="http://www.ecerami.com/wsdl/HelloService.wsdl"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
</pre>
</div>

<p>
DÃ©finition des Namespaces pour Ã©viter les conflits de noms. 
<tt>targetNamespace</tt> permet de rÃ©fÃ©rencer le document lui-mÃªme.
Le namespace par dÃ©faut est <tt>http://schemas.xmlsoap.org/wsdl/</tt> 
(i.e. sans prÃ©fixe, c'est le namespace utilisÃ©). 
</p>

</div>

<!-- _______________________ message ___________________________ -->
<div class="slide">
<h1>Hello World en WSDL (message)</h1>

<div class="listing-normal">
<pre>
&lt;message name="DisBonjourRequest"&gt;
   &lt;part name="monom" type="xsd:string"/&gt;
&lt;/message&gt;
&lt;message name="DisBonjourResponse"&gt;
   &lt;part name="greeting" type="xsd:string"/&gt;
&lt;/message&gt;
</pre>
</div>

<p>
Les deux messages dÃ©finis correspondent aux entrÃ©es et sorties.
Pour plusieurs arguments en entrÃ©e ou en sortie, on aurait plusieurs
Ã©lÃ©ments &lt;part&gt;.
</p>
</div>
<!-- _______________________ portType ___________________________ -->

<div class="slide">
<h1>Hello World en WSDL (portType)</h1>

<div class="listing-normal">
<pre>
&lt;portType name="bonjour_PortType"&gt;
   &lt;operation name="DisBonjour"&gt;
      &lt;input message="tns:DisBonjourRequest"/&gt;
      &lt;output message="tns:DisBonjourResponse"/&gt;
   &lt;/operation&gt;
&lt;/portType&gt;
&lt;/pre&gt;
</div>

<p>
L'Ã©lÃ©ment &lt;portType&gt; est le plus important:
il dÃ©finit le web service=<b>l'opÃ©ration</b> (mÃ©thode) qu'on peut invoquer 
et les messages impliquÃ©s.
</p>
</div>

<!-- _______________________ binding ___________________________ -->

<div class="slide">
<h1>Hello World en WSDL (binding)</h1>

<p>
Indique par quel protocole les opÃ©rations vont Ãªtre transportÃ©es. 
Le plus souvent, Ã  travers SOAP comme ici. 
</p>
<div class="listing-normal">
<pre>
&lt;binding name="bonjour_Binding" type="tns:bonjour_PortType"&gt;
      &lt;soap:binding style="rpc" transport="http://schemas.xmlsoap.org/soap/http"/&gt;
      &lt;operation name="DisBonjour"&gt;
         &lt;soap:operation soapAction="DisBonjour"/&gt;
         &lt;input&gt;
            &lt;soap:body
               encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"
               namespace="urn:examples:helloservice"
               use="encoded"/&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;soap:body
               encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"
               namespace="urn:examples:helloservice"
               use="encoded"/&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
&lt;/binding&gt;
</div>

</div>

<!-- _______________________ tools  ___________________________ -->
<div class="slide">
<h1>Outils intÃ©ressants</h1>

<ul>
<li>wsdlpull <a href="http://wsdlpull.sourceforge.net/">http://wsdlpull.sourceforge.net/</a> </li>
</ul>

</div>



<!-- ============================ Toolkit RPC / CLient ================== -->



<!-- _________________ Toolkits pour Ã©crire des clients _________________ -->
<div class="slide">
<h1>Toolkits pour SOAP</h1>

<p>
Les messages XML sont la plupart du temps cachÃ©s au programmeur car il
existe des outils existent dans de nombreux langages pour encoder/dÃ©coder
les messages XML. (On parle de <em>sÃ©rialisation/dÃ©-sÃ©rialisation</em>).
</p>

Quelques toolkits sont prÃ©sentÃ©s ici:
<ul>
  <li><a href="http://www.soaplite.com">SOAP::Lite</a> pour Perl,</li>
  <li><a href="http://ws.apache.org/soap/">Apache SOAP</a> pour Java,</li>
  <li><a href="http://cvs.gnome.org/viewcvs/libsoup">libsoup</a> pour C.</li>
  <li><a href="http://www.php.org">PHP5</a> contient une classe SOAP.</li> 
</ul>

</div>
 
<!-- _________________ Exemple SOAP::Lite client _________________ -->
<div class="slide">
<h1>Exemple client Perl</h1>

<p>
<a href="http://www.soaplite.com/">SOAP::Lite</a> permet de construire
une requÃªte RPC de maniÃ¨re trÃ¨s concise de la forme:
</p>
<div class="listing-normal">
<pre>
  use SOAP::Lite;

  print SOAP::Lite -&gt; uri($namespace)
                   -&gt; proxy($service_URL)
                   -&gt; $method_name($param)
                   -&gt; result;
</pre>
</div>

<ul>
<li><tt>uri()</tt>: chaque proxy peut proposer plusieurs services (classes).
L'URI est ici un nom unique de service.</li>

<li><tt>proxy()</tt> est l'adresse du serveur Ã  contacter pour accÃ©der Ã  la mÃ©thode. 
On peut utiliser les protocoles http:, mailto:, ou ftp:.</li>


<li><tt>result</tt> est un scalaire. Dans le cas oÃ¹ le rÃ©sultat est un vecteur
il faut utiliser <tt>paramsout</tt> Ã  la place.</li>
</ul>
</div>


<!-- _________________ Exemple SOAP::Lite client BabelFish _________________ -->
<div class="slide">
<h1>Exemple client Perl: BabelFish</h1>

<p style="font-size:smaller;font-weight:italic;background:grey">
Detailed Description<br>

IMPORTANT NOTE: Our own access to the Altavista Babelfish data has been
terminated, so this web service has been disabled.  The service will remain down
indefinitely until a suitable replacement translation engine can be found.
</p>

<p>
Appel au service de traduction <a href="http://www.babelfish.org/">BabelFish</a>.
<br/>
source : [ <a href="src/soap/soap-lite/babelfish.pl">babelfish.pl</a> ].
</p>

<div class="listing-normal">
<pre>
  #!perl -w

  use SOAP::Lite;

  print SOAP::Lite                                            
    -&gt; uri('urn:xmethodsBabelFish')
    -&gt; proxy('http://services.xmethods.net:80/perl/soaplite.cgi')
    -&gt; BabelFish('en_fr','The weather is fine. Let us go.')
    -&gt; result;
</pre>
</div>

</div>

<!-- _________________ Exemple SOAP::Lite client pour WSDL _________________ -->
<div class="slide">
<h1>Exemple client Perl pour WSDL</h1>

<p>
<a href="http://www.soaplite.com/">SOAP::Lite</a> permet d'invoquer indirectement
une mÃ©thode dÃ©crite dans un fichier <a href="#WSDL">WSDL</a>.
Dans ce cas l'objet est construit par:
</p>
<div class="listing-normal">
<pre>
  use SOAP::Lite;

  print SOAP::Lite -&gt; service($URL_to_wsdl_file)
                   -&gt; $method_name($param);
</pre>
</div>
<p>
Une requÃªte est faite pour rÃ©cupÃ©rer la description, la parse, construit le stub
(i.e. l'objet Ã©quivalent Ã©voquant le service).
</p>
<p>
Note 1: on peut invoquer plusieurs fois le service sans refaire la requÃªte au WSDL :
<span><pre> 
  my $service= SOAP::Lite -&gt; service('http://... .wsdl');
  print $service-&gt;method('a') + $service-&gt;method('a');
</pre></span> 
</p>
<p>
Note 2: le fichier peut Ãªtre local :
<pre> 
  -&gt;service('file:// ... .wsdl');
</pre>
</p>
</div>


<!-- _________________ Exemple SOAP::Lite client BabelFish WSDL _________________ -->
<div class="slide">
<h1>Exemple client Perl: BabelFish</h1>

<p>
Appel au service de traduction <a href="http://www.babelfish.org/">BabelFish</a>
Ã  travers une description WSDL. <br/>
source : [ <a href="src/soap/soap-lite/babelfish2.pl">babelfish2.pl</a> ].
</p>

<div class="listing-normal">
<pre>
  #!perl -w

  use SOAP::Lite;

  print SOAP::Lite                                            
    -&gt; service('http://www.xmethods.net/sd/2001/BabelFishService.wsdl')
    -&gt; BabelFish('en_fr','The weather is fine. Let us go.');
</pre>
</div>

</div>

<!-- _________________ Exemple Apache SOAP client _________________ -->
<div class="slide">
<h1>Exemple client Java (<a href="http://ws.apache.org/soap/">Apache SOAP</a>)</h1>
<div class="listing">
<pre>
//
// XMethods sample client for the Stock Quote service
//
import java.io.*;
import java.net.*;
import java.util.*;
import org.apache.soap.util.xml.*;
import org.apache.soap.*;
import org.apache.soap.rpc.*;

public class stockquoteClient{

  public static float getQuote (URL url, String symbol) throws Exception {

    Call call = new Call ();

    // Service uses standard SOAP encoding
    String encodingStyleURI = Constants.NS_URI_SOAP_ENC;
    call.setEncodingStyleURI(encodingStyleURI);

    // Set service locator parameters
    call.setTargetObjectURI ("urn:xmethods-delayed-quotes");
    call.setMethodName ("getQuote");

    // Create input parameter vector
    Vector params = new Vector ();
    params.addElement (new Parameter("symbol", String.class, symbol, null));
    call.setParams (params);

    // Invoke the service ....
    Response resp = call.invoke (url,"");
</pre>
</div>

(../..)

</div>
<div class="slide">
<h1>Exemple client Java (2/2)</h1>
<div class="listing">
<pre>
    // ... and evaluate the response
    if (resp.generatedFault ()) {
	throw new Exception();
    } else {
      // Call was successful. Extract response parameter and return result
      Parameter result = resp.getReturnValue ();
      Float rate=(Float) result.getValue();
      return rate.floatValue();
    }
  }

// Driver to illustrate service invocation
  public static void main(String[] args) {
    try {
          URL url=new URL("http://services.xmethods.net:80/soap");
          String symbol= "TRW";
          float quote = getQuote(url,symbol);
          System.out.println(quote);
    }
    catch (Exception e) {e.printStackTrace();}
  }
}
</pre>
</div>
</div>

<!-- _________________ Exemple C SOAP client _________________ -->
<div class="slide">
<h1>Exemple client C </h1>

<p>
La librairie <a href="http://cvs.gnome.org/viewcvs/libsoup">libsoup</a> 
est utilisÃ©e dans le projet <a href="http://www.gnome.org">GNOME</a>.
</p>
<p>
<b>Exemple</b>: <br/>
Recherche dans des dictionnaires.
Le noeud SOAP <a href="http://services.aonaware.com/DictService/DictService.asmx">
http://services.aonaware.com/DictService/DictService.asmx</a>
fournit diffÃ©rents services, dont Define.
</p>
<p>
listing complet : [ <a href="src/soap/soup/dict.c"> dict.c </a> ].
</p>

</div>

<!-- _________________ Exemple C SOAP client _________________ -->
<div class="slide">
<h1>Exemple client C </h1>

<div class="listing">
<pre>
int main (int argc, char **argv)
{
	SoupUri *proxy = NULL;
	SoupSoapMessage *msg;

	session = soup_session_async_new_with_options (SOUP_SESSION_PROXY_URI, proxy,NULL);
	msg = soup_soap_message_new ("POST",
				     "http://services.aonaware.com/DictService/DictService.asmx",
				     FALSE, NULL, NULL, NULL);

	soup_message_add_header (SOUP_MESSAGE (msg)-&gt;request_headers,
				 "SOAPAction", "http://services.aonaware.com/webservices/Define");
	soup_soap_message_start_envelope (msg);
	soup_soap_message_start_body (msg);
	soup_soap_message_start_element (msg,"Define",NULL,"http://services.aonaware.com/webservices/");
	soup_soap_message_add_namespace (msg, NULL, "http://services.aonaware.com/webservices/");
	soup_soap_message_start_element (msg, "word", NULL, NULL);
	soup_soap_message_write_string (msg, argv[0]);
	soup_soap_message_end_element (msg);
	soup_soap_message_end_element (msg);
	soup_soap_message_end_body (msg);
	soup_soap_message_end_envelope (msg);
	soup_soap_message_persist (msg);
	soup_session_queue_message (session, SOUP_MESSAGE (msg), got_response, NULL);
	loop = g_main_loop_new (NULL, TRUE);
	g_main_run (loop);
}
</pre>
</div>
</div>


<div class="slide">
<h1>Exemple client C (libsoup) 2/3</h1>

DÃ©codage de la rÃ©ponse:

<div class="listing">
<pre>
static void got_response (SoupMessage *msg, gpointer user_data)
{
	SoupSoapResponse *response;
	SoupSoapParameter *param, *subparam;
	char *word, *dict, *def;
	int count = 0;

	if (!SOUP_STATUS_IS_SUCCESSFUL (msg->status_code)) {
		fprintf (stderr, "%d %s\n", msg->status_code, msg->reason_phrase); exit (1);
	}
	response = soup_soap_message_parse_response (SOUP_SOAP_MESSAGE (msg));
	if (!response) {
		fprintf (stderr, "Could not parse SOAP response\n"); exit (1);
	}
	param = soup_soap_response_get_first_parameter_by_name (response, "DefineResult");
	if (!param) {
		fprintf (stderr, "Could not find result in SOAP response\n"); exit (1);
	}
	param = soup_soap_parameter_get_first_child_by_name (param, "Definitions");
	if (!param)
		goto done;
</pre>
</div>
(../..)
</div>


<div class="slide">
<h1>Exemple client C (libsoup) 3/3</h1>
<div class="listing">
<pre>
	for (param = soup_soap_parameter_get_first_child_by_name (param, "Definition");
	     param;
	     param = soup_soap_parameter_get_next_child_by_name (param, "Definition")) {
		subparam = soup_soap_parameter_get_first_child_by_name (param, "Word");
		if (!subparam)
			continue;
		word = soup_soap_parameter_get_string_value (subparam);

		subparam = soup_soap_parameter_get_first_child_by_name (param, "Dictionary");
		if (subparam)
			subparam = soup_soap_parameter_get_first_child_by_name (subparam, "Name");
		if (subparam)
			dict = soup_soap_parameter_get_string_value (subparam);
		else
			dict = NULL;

		printf ("% 2d. %s (%s):\n", ++count, word, dict);
		g_free (word);
		g_free (dict);

		subparam = soup_soap_parameter_get_first_child_by_name (param, "WordDefinition");
		if (subparam) {
			def = soup_soap_parameter_get_string_value (subparam);
			printf ("%s\n", def);
			g_free (def);
		}
	}

 done:
	if (count == 0)
		printf ("No definition\n");

	g_object_unref (response);
	g_main_quit (loop);
}
</pre>
</div>

</div>

<!-- _________________ PHP  _________________ -->
<div class="slide">
<h1>Exemple client PHP</h1>

<p>
PHP contient depuis PHP5 un support natif de SOAP (si compilÃ© avec --enable-soap). 
</p>
<div class="listing-normal">
<pre>
&lt;?php
    $client = new SoapClient(NULL,
        array("location" => "http://64.124.140.30:9090/soap",
              "uri"      => "urn:xmethods-delayed-quotes",
              "style"    => SOAP_RPC,
              "use"      => SOAP_ENCODED));

print($client-&gt;__call(
        "getQuote", 
        /* Method params */
         array(new SoapParam( "ibm", "symbol")),
        /* Options */
        array(
            /* SOAP Method Namespace */
            "uri" => "urn:xmethods-delayed-quotes",
            /* SOAPAction HTTP Header for SOAP Method */
            "soapaction" => "urn:xmethods-delayed-quotes#getQuote"
        )). "\n");
?&gt;
</pre>
</div>


</div>
<!-- _________________ Exemple client PHP  _________________ -->
<div class="slide">
<h1>Exemple client PHP pour WSDL</h1>

<p>
La classe permet Ã©galement (comme SOAP::Lite) de parser un WSDL avant d'invoquer une mÃ©thode.
Le WSDL tÃ©lÃ©chargÃ© est ou non mis en cache (<tt>soap.wsdl_cache_enabled</tt> dans phph.ini).
</p>
<div class="listing-normal">
<pre>
&lt;?php
$client = new
    SoapClient(
    "http://services.xmethods.net/soap/urn:xmethods-delayed-quotes.wsdl"
    );

print($client->getQuote("ibm"));
?&gt;
</pre>
</div>


</div>
<!-- ============================================================== -->

<!-- _______________________ Exos  ___________________________ -->
<div class="slide">
<h1>Exercices</h1>

<p style="font-size:smaller;font-weight:italic;background:grey">
Attention: cet exercice nÃ©cessite de crÃ©er un compte chez Google (gratuitÃ© totale). Je n'ai aucun intÃ©rÃªt dans cette entreprise. NÃ©anmoins, La contrepartie Ã  la crÃ©ation d'un compte est l'utilisation de services puissants qui justifient l'exercice.
</p>

<p>
<a href="http://www.google.com/apis/">Google</a> fournit des services SOAP (moyennant la crÃ©ation d'une clÃ©).
Ceux ci sont dÃ©crits dans le fichier WSDL suivant : [ <a href="src/soap/wsdl/GoogleSearch.wsdl">GoogleSearch.wsdl</a> ].
</p>

<ol>
<li>CrÃ©er un <a href="https://www.google.com/accounts/NewAccount?continue=http://api.google.com/createkey&amp;followup=http://api.google.com/createkey">compte</a> pour obtenir une clÃ©.</li>
<li>Ecrire un client SOAP::Lite qui donne le nombre de rÃ©sultats obtenus (estimatedTotalResultsCount) par une recherche <tt>doGoogleSearch</tt>.</li>
</ol>

</div>

<!-- _______________________ Exos  ___________________________ -->
<div class="slide">
<h1>Exercices</h1>

<p>
Le site <a href="http://www.xmethods.com">XMethods</a> recense
un ensemble de web-services publics.
</p>

<p>
Parmi ceux-ci un service de localisation gÃ©ographique capable de localiser une IP.
La fiche de ce service est 
<a href="http://www.xmethods.com/ve2/ViewListing.po?key=uuid:5ADFD852-70F4-0983-4B3B-A28F3DB014C1">
ici</a>
</p>
<p>
Ecrire une requÃªte SOAP pour trouver la latitude et longitude d'une IP dont vous 
connaissez l'emplacement gÃ©ographique.
</p>
<p>
Pour les dÃ©tails, voir l'exercice de mise en application: [ <a href="soap-td.html">html</a> ].
</p>


</div>

<!-- _______________________ demo  ___________________________ -->
<div class="slide">
<h1>DÃ©mo Mozilla</h1>

<p>
Mozilla (et les navigateurs basÃ©s sur Mozilla) sont dotÃ©s d'une API Javascript 
pour SOAP. Des dÃ©tails sont donnÃ©s dans cet <a href="http://mozilla.tlk.fr/doc09.php">article</a>.
</p>
<p style="font-weight:italic">Attention: pour fonctionner, les fichiers doivent Ãªtre locaux.</p>

<script type="text/javascript" src="src/soap/js/googleapi.js"></script>
<script type="text/javascript">
    
    function spell()
    {
        var f = document.forms["formu"].elements;
        var key = "RegvGPFQFHKAht9PBeGYj2b/UHz7QA3d";
        var phrase = f["phrase"].value;
        spellingSuggestion(phrase,key,showResults);
    }
    
    function showResults(results)
    {
        params = results.getParameters(false,{});
        var s = "";
        for (var i=0; i<params.length;i++) {
        
            s += params[i].value + "\n";
        }
        document.forms["formu"].elements["results"].value = s;
    }
</script>

<form action="#" name="formu">
<p>Phrase Ã  vÃ©rifier:<br />
<input type="text" name="phrase" width="25" value="Stephane Gneaud"/>
<input type="button" 
       value="SuggÃ©rer autre chose" onclick="spell(); return false;"/>
</p>
<p>
Google Results:<br />
<textarea cols="20" rows="10" name="results"> </textarea>
</p>
</form>

</div>


</div> <!-- ********** div final ************* -->
</body>
</html>

