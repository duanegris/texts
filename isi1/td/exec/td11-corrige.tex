\documentclass[a4paper,12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[francais]{babel}
\usepackage{mathptmx}
\usepackage[scaled]{helvet}
\usepackage{courier}

\usepackage[margin=2.2cm,nohead,foot=1cm]{geometry}
\usepackage[compact,sf,small]{titlesec}
\usepackage{parskip}
\usepackage{graphicx}
\usepackage{fancyvrb}

\begin{document}

{\large\sffamily
\begin{tabular}[t]{l}
  ENSIIE 1\textsuperscript{e} année\\
  Systèmes
\end{tabular}%
\hfill%
\begin{tabular}[t]{r}
  Année 2009-2010
  %\\ A. Ketterlin
\end{tabular}}

\vspace{2em}
\begin{center}
  \Large\bfseries\sffamily TP \no11
\end{center}
\vspace{1em}


\section{Stack smash}

On considère le programme suivant~:
\begin{verbatim}
#include <stdio.h>
void muahaha()
{
    ...
}
int main()
{
    printf("Hello\n");
    muahaha();
    printf("World\n");
    return 0;
}
\end{verbatim}
Le but est d'écrire le corps de la fonction \texttt{muahaha()} afin
qu'elle modifie le contenu de la pile et change son adresse de
retour~: en particulier, on aimerait que cette fonction empêche le
\emph{second} appel à \texttt{printf()}.

\begin{enumerate}
\item Comment peut-on faire pour que la fonction \texttt{muahaha()}
  affiche le contenu de la pile~? Affichez par exemple 8*8 octets de
  la pile~?

  (Sur la machine Turing, le type \texttt{int} est de taille 4 octets,
  alors que \texttt{long int} est de 8 octets~: utilisez ce dernier
  pour désigner les éléments de la pile.)
\item Utilisez la commande \texttt{objdump} pour déterminer l'adresse
  de retour de \texttt{muahaha()} (c'est-à-dire l'adresse de
  l'instruction de \texttt{main} qui suit celle qui appelle
  \texttt{muahaha}).
\item Utilisez les résultats des deux questions précédentes pour
  que la fonction \texttt{muahaha} reécrive son adresse de retour. A
  l'exécution, le programme doit afficher simplement \texttt{Hello},
  et pas \texttt{World}.
\end{enumerate}


\begin{verbatim}
% objdump -d hack | less
  ... search for main ...

08048408 <main>:
8048408:       55                      push   %ebp
8048409:       89 e5                   mov    %esp,%ebp
804840b:       83 e4 f0                and    $0xfffffff0,%esp
804840e:       83 ec 10                sub    $0x10,%esp
8048411:       c7 04 24 00 85 04 08    movl   $0x8048500,(%esp)
8048418:       e8 fb fe ff ff          call   8048318 <puts@plt>
804841d:       e8 c2 ff ff ff          call   80483e4 <muahaha>
8048422:       c7 04 24 06 85 04 08    movl   $0x8048506,(%esp)
8048429:       e8 ea fe ff ff          call   8048318 <puts@plt>
804842e:       b8 00 00 00 00          mov    $0x0,%eax
 \end{verbatim}

\end{document}
